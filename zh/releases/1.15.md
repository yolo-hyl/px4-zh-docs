

# PX4-Autopilot v1.15 发布说明

<Badge type="tip" text="Stable"/>

v1.15 版本带来了大量新升级和修复，部分归功于社区对1.14版本的积极响应。  
特别是，PX4 v1.15 为通过 [ROS 2](../ros2/index.md) 和 [uXRCE-DDS middleware](../middleware/uxrce_dds.md) 将 PX4 用作目标平台的开发者和集成商带来了重大改进。  
除了网络和中间件更新外，新的 [PX4 ROS 2 Interface Library](../ros2/px4_ros2_interface_lib.md) 允许作为 ROS 2 应用程序编写的飞行模式与 PX4 飞行模式并行运行。

此版本还新增了从传感器到驱动器的硬件支持，这得益于我们不断扩大的行业合作伙伴网络。  
在此版本中，您将享受到常见硬件选项的更新支持，部分支持由制造商直接赞助。  
我们对他们给予的支持表示感谢！

最后，导航代码中进行了许多改进和错误修复，这将带来更愉快的体验和更直接的调试过程。

所有这些改进使得 PX4 v1.15 成为一个理想的版本，特别是对于已经享受1.14版本诸多优势的用户。  
我们希望更多用户尝试此版本，并在 GitHub 上向开发团队报告任何问题。([了解如何提交问题](../contribute/support.md#issue-bug-reporting))。

请继续阅读 [升级指南](#升级指南)。

## 主要变更

- 导航功能的重大改进
- 新增和更新的硬件支持
- Dynamic Modes API
- <Badge type="warning" text="Experimental"/>[PX4 ROS 2 接口库](../ros2/px4_ros2_interface_lib.md) that simplifies controlling PX4 from ROS 2.

## 升级指南

- **Gazebo** 已取代 **jMAVSim** 作为 PX4-Autopilot 的默认仿真引擎。
  如果您正在使用 JMAVSim，请迁移到 Gazebo，因为我们将未来的重点放在那里。
- 参数 `SYS_MC_EST_GROUP` 已被移除，现在有专用参数用于选择估计器。
  继续阅读以了解更改详情。

## 其他更改

### 硬件支持

- **[Pixhawk标准]** Pixhawk飞控总线(PAB)拆分基础ID和FMU ID ([PX4-Autopilot#22639](https://github.com/PX4/PX4-Autopilot/pull/22639))
- **[Pixhawk标准] [FMUv6X]** 增加TELEM2 RX缓冲区大小以提高吞吐量 ([PX4-Autopilot#21660](https://github.com/PX4/PX4-Autopilot/pull/21660))
- **[新硬件]** 支持FMUv6XRT - Pixhawk 6X-RT ([PX4-Autopilot#22263](https://github.com/PX4/PX4-Autopilot/pull/22263))
- **[新硬件]** MicoAir H743 ([PX4-Autopilot#23218](https://github.com/PX4/PX4-Autopilot/pull/23218))
- **[新硬件]** ARK Mosaic-X5 RTK GPS ([PX4-Autopilot#22735](https://github.com/PX4/PX4-Autopilot/pull/22735))
- **[新硬件]** ARK Pi6X Flow ([PX4-Autopilot#22829](https://github.com/PX4/PX4-Autopilot/pull/22829))
- **[功能]** 为Auterion电源模块添加选择器 ([PX4-Autopilot#22073](https://github.com/PX4/PX4-Autopilot/pull/22073))
- **[灯光]** 添加LP5562 RGBLED驱动 ([PX4-Autopilot#21649](https://github.com/PX4/PX4-Autopilot/pull/21649))
- **[Holybro]** 在KakuteH7 / KakuteH7v2 / KakuteH7mini上启用EKF2 ([PX4-Autopilot#21961](https://github.com/PX4/PX4-Autopilot/pull/21961))
- **[Cubepilot]** 添加对Orange+第四代的支持 ([PX4-Autopilot#22039](https://github.com/PX4/PX4-Autopilot/pull/22039))
- **[3DR]** Zero Classic控制支持改进 ([PX4-Autopilot#22971](https://github.com/PX4/PX4-Autopilot/pull/22971))

### 常见

- `SYS_MC_EST_GROUP` 已被移除，现在有专用参数 [EKF2_EN](../advanced_config/parameter_reference.md#EKF2_EN)、[ATT_EN](../advanced_config/parameter_reference.md#ATT_EN) 和 [LPE_EN](../advanced_config/parameter_reference.md#LPE_EN) 用于 [切换状态估计器](../advanced/switching_state_estimators.md) ([PX4-Autopilot#22567](https://github.com/PX4/PX4-Autopilot/pull/22567))
  - 大多数配置应启用 [EKF2_EN](../advanced_config/parameter_reference.md#EKF2_EN)（默认值）。
- **[Bootloader]** 添加强制擦除选项和引导程序版本 ([PX4-Autopilot#22777](https://github.com/PX4/PX4-Autopilot/pull/22777))
- **[uORB]** 允许超过 255 个 uORB 消息 ([PX4-Autopilot#21923](https://github.com/PX4/PX4-Autopilot/pull/21923))
- **[Feature]** <Badge type="warning" text="实验性"/> Zenoh Pico 支持 ([PX4-Autopilot#22017](https://github.com/PX4/PX4-Autopilot/pull/22017))
- **[Feature]** 改进任务恢复，例如回放调查任务的云台和相机命令 ([PX4-Autopilot#21710](https://github.com/PX4/PX4-Autopilot/pull/21710))
- **[Feature]** 根据前一个任务项的飞行速度恢复任务 ([PX4-Autopilot#21714](https://github.com/PX4/PX4-Autopilot/pull/21714))
- **[Feature]** 在导航即将失败时发出用户警告 ([PX4-Autopilot#21876](https://github.com/PX4/PX4-Autopilot/pull/21876))
- **[Navigator]** 地理围栏改进 ([PX4-Autopilot#22394](https://github.com/PX4/PX4-Autopilot/pull/22394))
- **[Improvement]** 指挥器：在因检查失败而拒绝武装时触发警告 ([PX4-Autopilot#22885](https://github.com/PX4/PX4-Autopilot/pull/22885))
- **[Improvement]** 指挥器：缩短安全警告 ([PX4-Autopilot#22886](https://github.com/PX4/PX4-Autopilot/pull/22886))
- 支持远程参数数据库 ([PX4-Autopilot#22836](https://github.com/PX4/PX4-Autopilot/pull/22836))
- 新增平台无关的 UART 接口 ([PX4-Autopilot#21723](https://github.com/PX4/PX4-Autopilot/pull/21723))
- **[Improvement]** 新增单向 [终止手势](../config/safety.md#kill-gesture)，允许随时停止电机。默认禁用。[PX4-Autopilot#18509](https://github.com/PX4/PX4-Autopilot/pull/18509)
- **[Feature]** [大型机体的指南针校准](../config/compass.md#large-vehicle-calibration)。
  该方法专为无法或难以进行完整旋转的机体设计。
  ([PX4-Autopilot#15235](https://github.com/PX4/PX4-Autopilot/pull/15235), [PX4-Autopilot#15687](https://github.com/PX4/PX4-Autopilot/pull/15687))

### 控制

- **[外部控制]** [ros2外部控制](../flight_modes/offboard.md#ros-2-messages) 允许直接控制电机和舵机 ([PX4-Autopilot#22222](https://github.com/PX4/PX4-Autopilot/pull/22222))

### 估计

- 推导方式更改为 **误差状态卡尔曼滤波器** ([PX4-Autopilot#22262](https://github.com/PX4/PX4-Autopilot/pull/22262))  
  相较于当前"全状态"推导方式，"误差状态"推导的主要优势包括：  
  - 更好的收敛特性（对初始航向精度不敏感）  
  - 数值计算更稳定  
  - 计算开销更小  
  - 通过李群理论正确描述四元数不确定性  

- 使用 Joseph 稳定协方差更新算法提升协方差稳定性，并支持使用"考虑状态"（具有非零方差的非活跃状态） ([PX4-Autopilot#22770](https://github.com/PX4/PX4-Autopilot/pull/22770))  
- 使用 SymForce 自动生成协方差预测、测量雅可比矩阵、状态结构体和协方差索引  
- 通过 MAVLink 手动位置更新（`MAV_CMD_EXTERNAL_POSITION_ESTIMATE`）  
- 新增辅助全球定位（AGP）融合（例如：外部地图匹配视觉算法）  

**磁力计：**  

- 新增磁力计类型 "**Init**" (`EKF2_MAG_TYPE`)。在此模式下，磁力计仅用于初始化滤波器航向。  
  航向随后仅通过陀螺预测和位置/速度更新（例如：**GNSS**）进行估计。  
- 重构磁力计检测 (`EKF2_MAG_CHECK`)：  
  - 参数化强度容差 (`EKF2_MAG_CHK_STR`)  
  - 新增倾角检测 (`EKF2_MAG_CHK_INC`)  
- 重构磁力计航向融合，正确考虑磁偏置和地磁场不确定性  
- 允许在所有磁力计模式下进行磁偏置估计  
- 在 GNSS 辅助下，提升航向初始化失败后的收敛速度  

**IMU：**  

- 提升陀螺仪和加速度计偏置估计的数值稳定性（将角度差和速度差偏置改为加速度计和陀螺仪偏置）  

**光流：**  

- 现在可以在起飞前运行（适用于台架测试）  

**偏航紧急估计器：**  

- 更改为误差状态推导以提升性能  
- 现在可以在起飞前运行以初始化 EKF 的航向

### 传感器

- NXP UWB SR150 驱动修复 ([PX4-Autopilot#1123](https://github.com/PX4/PX4-Autopilot/pull/21124))
- Septentrio GPS 更新 ([PX4-Autopilot#23386](https://github.com/PX4/PX4-Autopilot/pull/23386))
- Ublox 新增 UBX-RXM-RTCM 用于RTCM输入状态 ([PX4-Autopilot#21595](https://github.com/PX4/PX4-Autopilot/pull/21595))
- 新增 TDK IIM42653 IMU 驱动 ([PX4-Autopilot#21019](https://github.com/PX4/PX4-Autopilot/pull/21019))
- **[功能]** 使空速传感器配置更简便，并与其他传感器保持一致 ([PX4-Autopilot#22510](https://github.com/PX4/PX4-Autopilot/pull/22510))
  - **[新参数]** `SYS_HAS_NUM_ASPD`, `FW_USE_AIRSPD`
- **[记录器]**: 记录所有GPS数据 ([PX4-Autopilot#22421](https://github.com/PX4/PX4-Autopilot/pull/22421))

### 仿真

- **[[Gazebo](../sim_gazebo_gz/index.md)]** 支持 [Advanced Plane](../sim_gazebo_gz/vehicles.md#advanced-plane)，这是一个模拟的固定翼机体，其空气动力学仿真效果优于常规飞机 ([PX4-Autopilot#22167](https://github.com/PX4/PX4-Autopilot/pull/22167), [gz-sim#2185](https://github.com/gazebosim/gz-sim/pull/2185))
- **[[Gazebo](../sim_gazebo_gz/index.md)]** 环境变量 `PX4_SIM_MODEL` 现可用于指示仿真模型 ([PX4-Autopilot#22400](https://github.com/PX4/PX4-Autopilot/pull/22400))
  - 该变量替代了现已弃用的 `PX4_GZ_MODEL`。
- **[[Gazebo](../sim_gazebo_gz/index.md)]** Gazebo 与 PX4 SITL 的分离 ([PX4-Autopilot#22467](https://github.com/PX4/PX4-Autopilot/pull/22467))
  - 仿真模块现在被拆分为两个独立部分。
  - 可按任意顺序独立启动，甚至可以跨网络在不同主机上运行。
  - Gazebo 通过 GUI 中的资源生成器支持拖放功能
- [JMAVSim Simulator](../sim_jmavsim/index.md) 现为 [社区支持](../simulation/community_supported_simulators.md) 状态。
  - 该模拟器已从官方 PX4 开发工具链中弃用，以便集中资源开发 [Gazebo](../sim_gazebo_gz/index.md)
- **[工具/模拟/gz]**：默认加载 ApplyLinkWrench 插件 ([PX4-Autopilot#21874](https://github.com/PX4/PX4-Autopilot/pull/21874))
- 允许用户在仿真中指定 Gazebo Garden/Harmony 渲染引擎 ([PX4-Autopilot#22693](https://github.com/PX4/PX4-Autopilot/pull/22693))
- 在 SITL Gazebo 中新增四旋翼垂起 VTOL 支持 ([PX4-Autopilot#20558](https://github.com/PX4/PX4-Autopilot/pull/20558))
- **[功能]** 参数用于启用/禁用 PX4 内部电池模拟器 ([PX4-Autopilot#22710](https://github.com/PX4/PX4-Autopilot/pull/22710))
  - **[新参数]** `SIM_BAT_ENABLE`
- **[gz-bridge]** 修复 GZ 在慢速启动仿真时的超时问题 ([PX4-Autopilot#22194](https://github.com/PX4/PX4-Autopilot/pull/22194))

### 以太网

- **[[以太网](../advanced_config/ethernet_setup.md)]** 默认的静态IP地址（用作DHCP的备用方案）已从`192.168.0.3`更改为`10.41.10.2` ([PX4-Autopilot#22517](https://github.com/PX4/PX4-Autopilot/pull/22517))  
  - 这可以避免潜在的冲突，即`192.168.0.x`范围被路由器用于WIFI/以太网网络时

### MAVLink

- **[云台]** 修复自动RC和MAVLink模式 ([PX4-Autopilot#23236](https://github.com/PX4/PX4-Autopilot/pull/23236))

### uXRCE-DDS 接口

- **[[uXRCE-DDS](../middleware/uxrce_dds.md)]** [DDS Topics YAML](../middleware/uxrce_dds.md#dds-topics-yaml) 现在允许使用 `subscription_multi` 指定特定 ROS 2 主题发送到为 ROS 2 保留的独立 uORB 主题实例 ([PX4-Autopilot#22266](https://github.com/PX4/PX4-Autopilot/pull/22266))
  - 这使 PX4 能够区分来自 ROS 和 PX4 uORB 发布者的更新
  - 通过此更改，ROS2 用户现在可以决定发送到 PX4 的消息是否会与现有 uORB 主题冲突，或存储在独立实例中
- 将 VOXL 从 microdds 客户端迁移到 UXRCE-DDS 客户端 ([PX4-Autopilot#22997](https://github.com/PX4/PX4-Autopilot/pull/22997))
- 添加参数以禁用 Agent 与客户端之间的时间同步 ([PX4-Autopilot#21757](https://github.com/PX4/PX4-Autopilot/pull/21757))
  - **[New Parameter]** `UXRCE_DDS_SYNCT`
  - **[Documentation]** [Middleware uXRCE-DDS](../middleware/uxrce_dds.md#starting-the-client) / [ROS 2](../ros2/user_guide.md#ros-gazebo-and-px4-time-synchronization) / [Gazebo Simulation](../sim_gazebo_gz/index.md#change-simulation-speed)

### ROS 2

- **[功能]** 动态模式API ([PX4-Autopilot#20707](https://github.com/PX4/PX4-Autopilot/pull/20707))
- **[功能]** **[[PX4 ROS 2接口库](../ros2/px4_ros2_interface_lib.md)]**<Badge type="warning" text="实验性"/>: 一个新的C++库，简化从ROS 2控制PX4的操作
  - 支持在ROS 2中添加与飞行控制器上运行的PX4模式平级的飞行模式
  - 模式行为与FMU内部模式保持一致
  - 传播到地面站并可由用户选择
  - 提供上锁检查和模式需求的接口
  - 集成到故障安全状态机中
- **[功能]** 多旋翼Go-to接口 ([PX4-Autopilot#22375](https://github.com/PX4/PX4-Autopilot/pull/22375))

## 平台变更

### 多旋翼

- **[新功能]** [抛投启动](../flight_modes_mc/throw_launch.md)<Badge type="warning" text="Experimental"/>：通过将多旋翼飞行器抛入空中来启动。[PX4-Autopilot#21170](https://github.com/PX4/PX4-Autopilot/pull/21170)
- **[新功能]** [慢速定位模式](../flight_modes_mc/position_slow.md)：这是 _Position mode_ 的慢速版本，其中最大水平速度、垂直速度和偏航速率轴可以配置为较低的值（使用参数、遥控器旋钮/开关或 MAVLink）。[PX4-Autopilot#22102](https://github.com/PX4/PX4-Autopilot/pull/22102)
- **[直升机]** 增加尾舵支持 [PX4-Autopilot#21274](https://github.com/PX4/PX4-Autopilot/pull/21274)
- **[直升机]** 恢复对共轴直升机的支持，使用新的执行器分配。[Documentation](../frames_helicopter/index.md), [PX4-Autopilot#22083](https://github.com/PX4/PX4-Autopilot/pull/22083)
- **[改进]** 多旋翼位置控制参数描述 ([PX4-Autopilot#21729](https://github.com/PX4/PX4-Autopilot/pull/21729))
- **[改进]** 默认电机PWM限制最小值为1100，最大值为1900。默认值已从900us更改为1000us！[Documentation](../advanced_config/esc_calibration.md), [PX4-Autopilot#21513](https://github.com/PX4/PX4-Autopilot/pull/21513)

### VTOL

- VTOL 后向转换：将倾斜时间作为参数公开并减少总时长 ([PX4-Autopilot#21760](https://github.com/PX4/PX4-Autopilot/pull/21760))
  - **[新参数]** `VT_BT_TILT_DUR`
- **[功能]** VTOL 尾坐式：在稳定模式下也添加自动俯仰坡度 ([PX4-Autopilot#22584](https://github.com/PX4/PX4-Autopilot/pull/22584))
- **[改进]** VTOL 前向推力辅助：将下降视为着陆模式 ([PX4-Autopilot#22843](https://github.com/PX4/PX4-Autopilot/pull/22843))
- 重构未指令的下降四轴降落伞 ([PX4-Autopilot#21598](https://github.com/PX4/PX4-Autopilot/pull/21598))
  - **[新参数]** `VT_QC_ALT_LOSS`

### 固定翼

- [简化空速传感器配置](../config_vtol/vtol_without_airspeed_sensor.md) ([PX4-Autopilot#22510](https://github.com/PX4/PX4-Autopilot/pull/22510))：
  - 用 [SYS_HAS_NUM_ASPD](../advanced_config/parameter_reference.md#SYS_HAS_NUM_ASPD) 替代参数 `CBRK_AIRSPD_CHK`，并将参数 `FW_ARSP_MODE` 重命名为 [FW_USE_AIRSPD](../advanced_config/parameter_reference.md#FW_USE_AIRSPD)。
  - 若需在无空速传感器时解锁，将 `SYS_HAS_NUM_ASPD` 设为 0。
  - 若控制器不使用空速传感器数据，将 `FW_USE_AIRSPD` 设为 0。
- **[改进]** 固定翼高动态风力强化 ([PX4-Autopilot#21764](https://github.com/PX4/PX4-Autopilot/pull/21764))
- 姿态控制器清理 ([PX4-Autopilot#22472](https://github.com/PX4/PX4-Autopilot/pull/22472))
- **[功能]** FW TECS：将 `FW_T_THR_DAMP` 重命名为 `FW_T_THR_DAMPING`，并将 `FW_T_I_GAIN_THR` 重命名为 `FW_T_THR_INTEG`（这些参数的含义已变更）([PX4-Autopilot#22548](https://github.com/PX4/PX4-Autopilot/pull/22548))
- **[功能]** 为 VTOL 启用高频率日志记录 ([PX4-Autopilot#22700)](https://github.com/PX4/PX4-Autopilot/pull/22700))
- **[功能]** 在固定翼特技模式中添加禁用特定轴速率控制的功能 ([PX4-Autopilot#21566](https://github.com/PX4/PX4-Autopilot/pull/21566))
  - **[新参数]** `FW_ACRO_AXS_CTRL`
- 将固定翼路径跟随作为独立控制器状态添加 ([PX4-Autopilot#21376](https://github.com/PX4/PX4-Autopilot/pull/21376))
- 为固定翼添加性能模型 ([PX4-Autopilot#22091](https://github.com/PX4/PX4-Autopilot/pull/22091))
  - **[新参数]** `FW_S_CEILING`

### Rover

- [Aion R1](../complete_vehicles_rover/aion_r1.md)<Badge type="warning" text="实验性"/>: Roboclaw电机控制器的电调驱动。
  该版本包含构建指南和Aion R1的支持，Aion R1是一款新型差速驱动车，同时提供Roboclaw电机控制器集成的相关信息。
- 为px4/fmu-{v5,v5x,v6c,v6x}添加专用Rover构建版本 ([PX4-Autopilot#22675](https://github.com/PX4/PX4-Autopilot/pull/22675))

## 更新日志

[完整更新日志请访问Github (v1.14.0...v1.15.0)](https://github.com/PX4/PX4-Autopilot/compare/v1.14.0...v1.15.0)